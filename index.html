<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>V1.8.1 Test Branch</title>
</head>
<body>
  <h1>Choose a page to open:</h1>
  <button onclick="openPage('https://akazimc.github.io/operationbreaker/Eaglercraft')">WASM-GC Eaglercraft</button>
  <button onclick="openPage('https://akazimc.github.io/operationbreaker/Eaglercraft-JS')">JS Eaglercraft</button>
  <br><br>
  <button onclick="toggleMode()" id="modeBtn">Mode: Open</button>

  <script>
    let mode = "open";   // can be "open" or "cache"

    function toggleMode() {
      mode = (mode === "open") ? "cache" : "open";
      document.getElementById("modeBtn").innerText = "Mode: " + (mode === "open" ? "Open" : "Cache");
    }

    function openPage(url) {
      let win = window.open("about:blank", "_blank");

      // In cache mode, store choice
      if (mode === "cache") {
        localStorage.setItem("cachedPage", url);
      }

      // Inject loader script into about:blank
      let doc = win.document;
      doc.open();
      doc.write(`
        <title>Loading...</title>
        <style>
          body { margin:0; height:100%; overflow:hidden; }
          iframe { border:none; width:100%; height:100%; }
        </style>
        <script>
          // Grab cached URL if in cache mode
          let url = ${JSON.stringify(url)};
          try {
            let cached = localStorage.getItem("cachedPage");
            if (cached) url = cached;
          } catch(e){}
          
          let iframe = document.createElement("iframe");
          iframe.src = url;
          document.body.appendChild(iframe);
        <\/script>
      `);
      doc.close();
    }
  </script>
</body>
</html>
